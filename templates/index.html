<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Games CRUD</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">

    <h1>Gerenciamento de Games</h1>

    <div class="card">
        <div class="form-grid">
            <input type="text" id="nome" placeholder="Nome do jogo">
            <input type="text" id="plataforma" placeholder="Plataforma">
            <input type="text" id="status" placeholder="Status">
            <input type="number" id="nota" placeholder="Nota">
        </div>

        <div class="buttons">
            <button id="btnSalvar" onclick="salvarJogo()">Criar</button>
            <button id="btnCancelar" onclick="cancelarEdicao()" style="display:none">Cancelar</button>
        </div>
    </div>

    <ul id="lista"></ul>

</div>

<script>
    let idEmEdicao = null;

    async function salvarJogo() {
        const nome = document.getElementById("nome").value;
        const plataforma = document.getElementById("plataforma").value;
        const status = document.getElementById("status").value;
        const nota = document.getElementById("nota").value;

        if (!nome || !plataforma || !status || !nota) {
            alert("Preencha tudo");
            return;
        }

        if (idEmEdicao === null) {
            await fetch("/games", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    name: nome,
                    platform: plataforma,
                    status: status,
                    rating: nota
                })
            });
        } else {
            await fetch(`/games/${idEmEdicao}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    name: nome,
                    platform: plataforma,
                    status: status,
                    rating: nota
                })
            });

            cancelarEdicao();
        }

        limparCampos();
        listarJogos();
    }

    function prepararEdicao(jogo) {
        document.getElementById("nome").value = jogo.nome;
        document.getElementById("plataforma").value = jogo.plataforma;
        document.getElementById("status").value = jogo.status;
        document.getElementById("nota").value = jogo.nota;

        idEmEdicao = jogo.id;

        document.getElementById("btnSalvar").innerText = "Atualizar";
        document.getElementById("btnCancelar").style.display = "inline";
    }

    function cancelarEdicao() {
        idEmEdicao = null;
        limparCampos();

        document.getElementById("btnSalvar").innerText = "Criar";
        document.getElementById("btnCancelar").style.display = "none";
    }

    function limparCampos() {
        document.getElementById("nome").value = "";
        document.getElementById("plataforma").value = "";
        document.getElementById("status").value = "";
        document.getElementById("nota").value = "";
    }

    async function listarJogos() {
        const resposta = await fetch("/games");
        const jogos = await resposta.json();

        const lista = document.getElementById("lista");
        lista.innerHTML = "";

        jogos.forEach(jogo => {
            const li = document.createElement("li");

            li.innerHTML = `
                <div class="game-info">
                    <strong>${jogo.nome}</strong><br>
                    ${jogo.plataforma} • ${jogo.status} • Nota ${jogo.nota}
                </div>
            `;

            const actions = document.createElement("div");
            actions.classList.add("actions");

            const btnEditar = document.createElement("button");
            btnEditar.innerText = "Editar";
            btnEditar.onclick = () => prepararEdicao(jogo);

            const btnExcluir = document.createElement("button");
            btnExcluir.innerText = "Excluir";
            btnExcluir.onclick = () => deletarJogo(jogo.id);

            actions.appendChild(btnEditar);
            actions.appendChild(btnExcluir);

            li.appendChild(actions);
            lista.appendChild(li);
        });
    }

    async function deletarJogo(id) {
        if (!confirm("Excluir?")) return;

        await fetch(`/games/${id}`, {
            method: "DELETE"
        });

        listarJogos();
    }

    listarJogos();
</script>

</body>
</html>